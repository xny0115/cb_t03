# AI 병합(머지) 충돌 방지 규칙  #AI_MERGE_RULES

본 규칙은 모든 프로젝트에서 **변경 없이** 적용됩니다.  
코덱스(Codex) 또는 기타 AI 에이전트가 자동 커밋·PR을 수행할 때 반드시 준수해야 합니다.

## 1) 작업 범위
- **실제 코드에 존재하는 파일·경로만** 수정 대상에 포함합니다.  
- 보존본(백업본) 디렉터리는 읽기 전용으로 취급하며, 수정·삭제·이동 금지합니다.  
  - 보존본 경로 예시: `_bak_*`, `backup/`, `archive/` 등

## 2) 브랜치 운용
- 기본 브랜치: `main`  
- AI 작업 브랜치명: `codex/feature/<YYYYMMDD>-<short>`  
- 병합(Merge) 시 **Fast-Forward 금지**, **Squash Merge**만 허용하여 히스토리를 단순화합니다.

## 3) 충돌 예방 절차
1. `git fetch --all --prune`  
2. 새로운 작업 브랜치 생성 또는 전환  
3. 변경 전 `git merge --no-ff origin/main` 으로 최신 코드 반영  
4. 테스트 및 검증 후 PR 생성  
5. 리뷰 지적사항 반영 시 3~4 과정 반복

## 4) 파일 잠금 규칙
- 핵심 진입점·메인 서비스 파일·모델 정의 파일은 **단독 변경 원칙**을 적용합니다.  
- 위 파일을 수정하는 PR은 **하나씩 순차 처리**하며, 병렬 PR 금지합니다.  
- 잠금 대상은 프로젝트별로 `MERGE_LOCK_FILES` 리스트로 정의합니다.

## 5) 자동 생성 산출물
- 학습 산출물·모델 가중치·토크나이저 파일·임시 데이터 등은 **Git 추적 금지**합니다.  
- `.gitignore`에 포함된 항목은 절대 커밋하지 않습니다.  
- 코드 포맷 변경만의 PR(예: isort/black 포맷팅 전용 PR)은 금지합니다.

## 6) PR 체크리스트
- 유닛 테스트 및 빌드 통과 여부 확인 (`pytest`, `build` 등)  
- 필수 의존성 설치 후 실행 가능 여부 확인  
- 변경된 파일명·함수명·경로명은 **실제 코드에 존재**하는 값만 사용  
- 병합 전 충돌 여부 확인
